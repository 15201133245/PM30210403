Gpay010510：
重要更新：
1.最早在010509T1版本上，为了分析“枪号不同”错误产生的原因，在WriteCRFuellingErrorLog函数里面增加了对Logical Nozzle Number和Transaction Nozzle Number的日志记录，新增加的日志记录代码导致52字节的buffer越界，如果加油中强行弹卡，则程序会调用WriteCRFuellingErrorLog写日志，从而导致CR出错重启，先屏蔽对Logical Nozzle Number和Transaction Nozzle Number的日志记录，以解决此问题

Gpay010511T1：
1.将BCTC测试更改问题整合至此版本：
    1.1行业类型错误卡，卡片实际的行业类型和卡片上面的卡号不符，要求提示 行业类型码错，实际提示 非本站员工卡
    分析：读取完0x15文件后，判断是员工卡后，【查白名单】，成功后会顺序读取0x16，0x1B，在读取完0x1B后我们的代码里面会判断行业类型，但是这个问题发生的原因为，【查白名单】 未通过，因为卡片表面显示的卡号和实际存储的不一致，导致增加白名单无效

    1.2密钥版本不对，提示 PSAM初始化灰锁失败，要求提示 密钥版本不支持
    分析：对于PSAM初始化灰锁返回的状态字要做更详细的判断，对于9403状态字提示 密钥版本不支持

    1.3有一张员工卡上面没有写卡号，无法加至白名单里面，要求对于白名单的查询方式为：后台在线则去后台查，不在线的情况下本地查
    分析：我们的处理方式为：本地表头完整可以查则本地查，否则去后台查【本次不修改】

    1.4非接触卡，加油完成后第二次选择应用失败
    分析：非接触卡选择应用之前需要激活卡片，现在的代码里面激活部分代码被屏蔽，之前模式2的测试就出过这个问题，当时修改了模式2的代码，但是模式0没有同步更新，因为目前我们是是小卡2套代码

    1.5“启用日期格式错”，“过期日期格式错”，统一提示“卡日期无效”
    1.6“卡应用未启用”改为“卡未启用”

2.增加一个界面用来查询后台POS表的信息【待修改】

3.增加预编译宏，将为贵州增加的检测加油中卡片是否真实存在的代码合并至此版本，如果是贵州版本，则版本号最后会添加一个字符G将贵州整合至此版本

4.将自动加油和协议测试代码合并至此版本

5.Common和POS修改【具体修改内容待补充】

6.弹卡增加时间判断，最快1秒弹一次，防止智能卡头多次快速弹卡导致弹卡电容无法充满，卡片弹不出来的问题

7.WriteCRFuellingErrorLog不在记录Pump_CR_Buf.NozzleNumber，改为记录PowerDown.PDPhysicalNozzleNumber

8.case CR_CARDREADER_CHECK_CARD_APDU:比对物理枪号时，增加先判断PowerDown.PowerDown.PDPhysicalNozzleNumber的值是否在正常范围内，如果不在，则用Pump_CR_Buf.NozzleNumber的值给它重新赋值~~~~~~~~~~~CR_CARDREADER_CHECK_CARD:130709

9.新现金交易更改【待修改】

10.CardDrive.c更改，对长度进行了限制

11.绩效管理打开的情况下，再插入用户卡等待输入员工号界面，直接抬枪没有报错信息

12.删除WriteDebugLog1，WriteDebugLog2，WriteDebugLog3，WriteDebugLog4

13.删除PSAMRetryTimes的日志记录，只保留重试次数大于3异常情况时的记录

16.老版本现金加油，“请抬枪加油”语音提示过早，应该在授权成功以后再报“请抬枪加油”

17.0交易重复要交易，枪号错误的问题

18.增加锁定油枪功能

19.条码未授权的情况下抬枪，会在CASH_TOTAL检测ProcStatus[PROCESS_PUMP] = PUMP_C_CALL重新置位，以使用户不用挂枪仍可加油

20.增加对“先抬枪，然后按油品选择按键，扫描条码”错误流程的容错处理，仍然可以正常加油

21.Cstartup.s修改，增加对“数据异常”“指令异常”的日志记录

22.石化盈科修改【待修改】

Gpay010511T2：
1.AscLog.c修改，解决日志覆盖的的问题【待修改】

Gpay010511T3：
1.AscLog.c修改，解决提前变价的问题

Gpay010511T4：
1.AscLog.c修改，修改提前变价的问题（LoadConfig里，对LoadGradePriceTime的调用）

Gpay010511T5：
1.AscLog.c修改，修改先擦下一页导致的重启问题

Gpay010511：
1.CR_CardReaderCheckCard增加定时器500毫秒延时检测，增加对定时器的非空检查，防止重复开定时器对资源及系统的耗费
2.CR_CardReaderSpringOutCard弹卡增加时间1秒判断，增加对定时器的非空检查，防止重复开定时器对资源及系统的耗费
3.testPOS文件编译不过，增加TEST_POS预编译
4.WriteToCardSam对len长度限制由256改为128
5.Cstartup.s修改，增加program_start位置及跳转

Gpay010511-1：
1.后台下发油价，IC卡变价下班；后台再次下发油价，但只是变更油价版本，IC卡仍然变价下班的问题。

PM30210101/PM30220101/PM30230101/PM30240101/：
1.上电显示新旧版本号各一条
2.版本信息查询显示新旧版本号各一条，原CRE/AT83c26位置填新版本号
3.上送管控使用旧版本号
4.掉电log中使用新版本号

PM30210102/PM30220102/PM30230102/PM30240102/：
1.CR未在合理时间和状态下（某些情况下不响应外部事件）响应CRE发送的占用请求。Cash程序在CARD_INSERTED标志建立之后，即时回应CRE不能占用。---解决各地油站出现的IC卡交易中rfu字段出现现金数据的问题。
2.IC卡显示屏有时错位的问题
3.存储交易记录前检查剩余空间，＜48条开始提示“记录将满,请联机上传”，＜16条时提示“保存交易记录失败”，停止IC卡应用，直到交易记录可用空间合法。

PM30210103/PM30220103/PM30230103/PM30240103/：
1.存储交易前检查剩余空间。改变之前设计规则，变化为，在剩余存储空间显示为16笔时，提示“空间不足，请联机上传”，因为在48笔时有抬枪限制，至16笔范围内泵码不会变化，因此不能存储至flash的交易记录不再保存，并且pos_ttc-1。

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
PM30210208/PM30220208/PM30230208/PM30240208/:
1.在原有基础上增加锁枪功能。增加全局标记Flag，加油过程中,当按选择键且为员工卡加油时将Flag置1，当加油结束时弹出解锁框。输入密码正确，Flag清0 。
  此处共有三处判断Flag弹输入密码框，①油机为CR授权抬枪时②按退卡键时③无PIN员工卡挂枪时。

PM30210208/：
1.在原有基础上增加卡类别识别功能。当插卡时，读出卡片内部AID，若AID与程序中的匹配，则可以进行后续操作；若不匹配则弹卡，并提示非本系统卡。
  当选择卡片识别选择“中石化”时，程序中识别的AID为 0xA0, 0x00, 0x00, 0x00, 0x03, 'S', 'I', 'N', 'O', 'P', 'E', 'C'
  当选择卡片识别选择“新华联”时，程序中识别的AID为 0xA0, 0x00, 0x00, 0x00, 0x03, 'O', 'I', 'L', 'P', 'L', '0', '1'
2.在原有基础上增加存油功能。
  ①当插卡时，若卡片内部含有存油应用（存油应用AID : 'V', 'O', 'L', 'A', 'P', 'P'）,显示卡余额界面，显示存油升数。
  ②加油过程中，从卡片内部扣款扣的是存油升数。（在解灰函数中Amount = Volume）
  ③加油仅能做升预制，不能做金额预制。
  ④上传交易。（DS=0x04，UNIT=0x62,PRC=1;RFU[0-1]=挂牌单价）
  ⑤打印。（扣前金额 改为 扣前油额，扣后金额 改为 扣后油额 ， 扣款来源：存油应用 ， 支付类型：油 ， 结算类型：升）
  ⑥若含有存油应用，且是非限油品卡，抬枪时，弹卡，并显示卡片存油应用错误。
3.在原有基础上增加明着明扣功能。
  ①从卡片的SFI 28（十进制）文件中备用字段的最后一个字节读取卡优惠等级。
  ②抬枪时，根据优惠等级取出油价。等级必须为（0-7），如果没有等级对应的油价，或等级数字>=8，都按挂牌单价处理交易。
  ③上传交易时，将PRC改为实际成交价格，RFU[0-1]挂牌单价，RFU[2]VIP等级。
  ④打印。去掉了加油站编码和流水号（POS-TTC）两个字段，增加了，加油金额，实扣金额，优惠金额。

PM30230208/PM30240208/:
1.在原有基础上增加车号识别和限油品功能。当从卡片中读出是限车号卡或限油品卡时，在来poll前开启定时器，当来poll后关闭定时器（防止如果CR与CRE因为不同从而进入死锁状态，超时时间为6s）
  同时将命令0x3F/0x41,发送到CRE并开启另一个定时器。若CRE不发送0x3f/0x41命令应答，CR会重发此命令，且重发次数为3。当CR收到命令0x40/0x42时，CR给CRE应答，且将定时器关闭。
  在等待油品核对或者等待车号识别过程中如果进度条走到头时，同样按照超时处理。当插入限车号卡是，若当前油机没有班，则弹出卡片。

PM30230209/PM30240209：
1.将失效卡的屏蔽放开

PM30210210/PM30220210/PM30230210/PM30240210：
1.增加语音“无效卡”
2.增加语音“请扫描条码”（PM30230210/PM30240210）
3.增加可配置打印功能，参照《市场和客户反馈改进项目跟踪进度表201409.xlsx》，在设置菜单中进行相应的设置
4.增加安全模式，维护菜单中，若该功能打开，司机卡加油时需输入员工密码
5.修改了部分CR板上的Bug，参照《市场和客户反馈改进项目跟踪进度表201409.xlsx》及《CR&CRE测试文档.xlsx》（PM30230210/PM30240210）

PM30210301/PM30220301/PM30230301/PM30240301:
1.下发两次油价，两次下发每条枪的单价个数不同（可用换后台的方式测试，如第一次为吉智后台，第二次为中石化后台）

PM30210302/PM30220302/PM30230302/PM30240302:
1.更改了软件版本号

PM30210401/PM30220401/PM30230401/PM30240401：
1.存油应用，四川航油修改需求，在用户卡中增加0015文件，根据文件内容来决定默认进入的应用

PM30210402/PM30220402/PM30230402/PM30240402：
1.对某些卡商和型号的卡黑名单卡不能锁卡的情况做修正

PM30210403/PM30220403/PM30230403/PM30240403：
1.只有“用户卡”在到达余额界面时才有语音提示信息，员工卡不再播报